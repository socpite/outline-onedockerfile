#!/bin/bash
# Simple startup script that ensures PostgreSQL is running and setup is complete

echo "ğŸš€ Starting Outline development environment..."

# Wait a bit for other services to start
sleep 5

# Check if PostgreSQL is running, if not start it
if ! sudo -u postgres pg_isready >/dev/null 2>&1; then
    echo "ğŸ“‹ Starting PostgreSQL..."
    sudo -u postgres /usr/lib/postgresql/15/bin/postgres -D /var/lib/postgresql/main &
    sleep 3
fi

# Run the setup if environment doesn't exist
if [ ! -f /home/ubuntu/outline/.env ]; then
    echo "ğŸ“‹ Running initial setup..."
    /usr/local/bin/setup-outline-dev
else
    echo "âœ… Environment already configured"
fi

echo "ğŸ‰ Outline development environment ready!"
echo "ğŸ–¥ï¸  VNC: http://localhost:6080/vnc.html"
echo "ğŸ“‹ Status: outline-status"