#!/bin/bash
# Production Outline startup script

set -e

cd /home/ubuntu/outline

echo "🚀 Starting Outline production server..."

# Load environment variables
if [[ -f .env ]]; then
    echo "📋 Loading environment..."
    source .env
else
    echo "❌ No environment file found!"
    exit 1
fi

# Quick service check (they should already be ready from setup)
echo "🔍 Checking services..."
if ! pg_isready -h localhost -p 5432 -U outline >/dev/null 2>&1; then
    echo "❌ Database not ready!"
    exit 1
fi

if ! redis-cli ping >/dev/null 2>&1; then
    echo "❌ Redis not ready!"
    exit 1
fi

echo "✅ Services ready"

# Start the production server
echo "🎉 Starting Outline server..."
exec yarn start