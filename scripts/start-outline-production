#!/bin/bash
# Production Outline startup script

set -e

cd /home/ubuntu/outline

echo "ğŸš€ Starting Outline production server..."

# Load environment variables
if [[ -f .env ]]; then
    echo "ğŸ“‹ Loading environment..."
    source .env
else
    echo "âŒ No environment file found!"
    exit 1
fi

# Quick service check (they should already be ready from setup)
echo "ğŸ” Checking services..."
if ! pg_isready -h localhost -p 5432 -U outline >/dev/null 2>&1; then
    echo "âŒ Database not ready!"
    exit 1
fi

if ! redis-cli ping >/dev/null 2>&1; then
    echo "âŒ Redis not ready!"
    exit 1
fi

echo "âœ… Services ready"

# Start the production server
echo "ğŸ‰ Starting Outline server..."
exec yarn start